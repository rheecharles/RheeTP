<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rhee TP V4.0 - Teleprompter Musical</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Cores do tema escuro */
            --dark-primary: #0a0a1a;
            --dark-secondary: #1a1a2e;
            --dark-tertiary: #2d2d44;
            --dark-text: #e6e6ff;
            --dark-accent: #78ffd6;
            --dark-accent-alt: #4e54c8;
            --dark-card: rgba(26, 26, 46, 0.95);
            --dark-input: rgba(45, 45, 68, 0.9);
            
            /* Cores do tema claro */
            --light-primary: #f5f7ff;
            --light-secondary: #e6e9ff;
            --light-tertiary: #d0d5ff;
            --light-text: #0a0a1a;
            --light-accent: #0066cc;
            --light-accent-alt: #5a67d8;
            --light-card: rgba(230, 233, 255, 0.95);
            --light-input: rgba(255, 255, 255, 0.9);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: var(--dark-primary);
            color: var(--dark-text);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            padding: 20px;
            transition: background 0.5s, color 0.5s;
            font-family: 'Montserrat', sans-serif;
            display: flex;
            flex-direction: column;
            background-image: radial-gradient(circle at 10% 20%, rgba(78, 84, 200, 0.1) 0%, transparent 20%),
                              radial-gradient(circle at 80% 80%, rgba(120, 255, 214, 0.1) 0%, transparent 20%);
        }

        body.light-theme {
            background: var(--light-primary);
            color: var(--light-text);
            background-image: radial-gradient(circle at 10% 20%, rgba(90, 103, 216, 0.05) 0%, transparent 20%),
                              radial-gradient(circle at 80% 80%, rgba(0, 102, 204, 0.05) 0%, transparent 20%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            flex: 1;
            width: 100%;
        }

        /* Botão de alternância de tema */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--dark-secondary);
            border: 2px solid var(--dark-tertiary);
            color: var(--dark-text);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 0 15px rgba(0,0,0,0.4);
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: rotate(15deg) scale(1.1);
        }

        body.light-theme .theme-toggle {
            background: var(--light-secondary);
            border: 2px solid var(--light-tertiary);
            color: var(--light-text);
        }

        .theme-toggle i {
            font-size: 1.5rem;
        }

        header {
            text-align: center;
            padding: 30px 0;
            position: relative;
        }

        .app-logo {
            width: 120px;
            height: 80px;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, var(--dark-accent-alt), #8f94fb);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 30px rgba(143, 148, 251, 0.4);
            animation: pulse 2s infinite;
            position: relative;
            overflow: hidden;
            border: 2px solid #4e54c8;
            transition: all 0.3s ease;
        }

        .app-logo:hover {
            transform: scale(1.05);
        }

        body.light-theme .app-logo {
            background: linear-gradient(135deg, var(--light-accent-alt), #8f94fb);
        }

        .app-logo::before {
            content: "Rhee";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 28px;
            font-weight: bold;
            color: white;
            z-index: 1;
            font-family: 'Orbitron', sans-serif;
        }

        .app-logo::after {
            content: "♪";
            position: absolute;
            bottom: 5px;
            right: 10px;
            font-size: 42px;
            color: rgba(255, 255, 255, 0.3);
            transform: rotate(-20deg);
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 30px rgba(143, 148, 251, 0.4); }
            50% { transform: scale(1.03); box-shadow: 0 0 40px rgba(143, 148, 251, 0.6); }
            100% { transform: scale(1); box-shadow: 0 0 30px rgba(143, 148, 251, 0.4); }
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, var(--dark-accent), #78ffd6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        body.light-theme h1 {
            background: linear-gradient(to right, var(--light-accent), #0077cc);
        }

        .subtitle {
            font-size: 1.1rem;
            color: #b0b9d8;
            max-width: 600px;
            margin: 0 auto 25px;
            line-height: 1.6;
        }

        body.light-theme .subtitle {
            color: #555555;
        }

        .card {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(120, 255, 214, 0.2);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }

        body.light-theme .card {
            background: var(--light-card);
            border: 1px solid rgba(0, 119, 204, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }

        .card-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--dark-accent);
            display: flex;
            align-items: center;
            gap: 15px;
            font-family: 'Orbitron', sans-serif;
        }

        body.light-theme .card-title {
            color: var(--light-accent);
        }

        .card-title i {
            background: linear-gradient(135deg, var(--dark-accent-alt), #8f94fb);
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        body.light-theme .card-title i {
            background: linear-gradient(135deg, var(--light-accent-alt), #8f94fb);
        }

        .search-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 16px 20px;
            border-radius: 15px;
            border: 2px solid var(--dark-accent-alt);
            background: var(--dark-input);
            color: var(--dark-text);
            font-size: 1.1rem;
            transition: all 0.3s ease;
            font-family: 'Montserrat', sans-serif;
        }

        body.light-theme .search-input {
            border: 2px solid var(--light-accent-alt);
            background: var(--light-input);
            color: var(--light-text);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--dark-accent);
            box-shadow: 0 0 20px rgba(120, 255, 214, 0.4);
            background: rgba(40, 44, 80, 0.9);
        }

        body.light-theme .search-input:focus {
            border-color: var(--light-accent);
            box-shadow: 0 0 20px rgba(0, 119, 204, 0.4);
        }

        .search-input::placeholder {
            color: #8a90c0;
        }

        body.light-theme .search-input::placeholder {
            color: #666;
        }

        .btn-search {
            background: linear-gradient(135deg, var(--dark-accent-alt), #8f94fb);
            color: white;
            border: none;
            padding: 16px 26px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(78, 84, 200, 0.4);
            font-family: 'Montserrat', sans-serif;
        }

        .btn-search:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(78, 84, 200, 0.6);
        }

        .btn-search:active {
            transform: translateY(0);
        }

        .search-status {
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .search-status.loading {
            background: rgba(41, 128, 185, 0.2);
            border: 1px solid #3498db;
            color: #3498db;
        }

        .search-status.success {
            background: rgba(46, 204, 113, 0.2);
            border: 1px solid #2ecc71;
            color: #2ecc71;
        }

        .search-status.error {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            color: #e74c3c;
        }

        .search-status.warning {
            background: rgba(241, 196, 15, 0.2);
            border: 1px solid #f1c40f;
            color: #f1c40f;
        }

        .lyrics-input {
            width: 100%;
            height: 250px;
            padding: 20px;
            border-radius: 15px;
            background: var(--dark-input);
            border: 2px solid var(--dark-accent-alt);
            color: var(--dark-text);
            font-size: 1.1rem;
            line-height: 1.7;
            resize: vertical;
            transition: all 0.3s ease;
            font-family: 'Montserrat', sans-serif;
        }

        body.light-theme .lyrics-input {
            background: var(--light-input);
            border: 2px solid var(--light-accent-alt);
            color: var(--light-text);
        }

        .lyrics-input:focus {
            outline: none;
            border-color: var(--dark-accent);
            box-shadow: 0 0 20px rgba(120, 255, 214, 0.4);
            background: rgba(40, 44, 80, 0.9);
        }

        body.light-theme .lyrics-input:focus {
            border-color: var(--light-accent);
            box-shadow: 0 0 20px rgba(0, 119, 204, 0.4);
        }

        .search-results {
            margin-top: 20px;
            max-height: 350px;
            overflow-y: auto;
            border-radius: 15px;
            background: var(--dark-input);
            border: 2px solid var(--dark-accent-alt);
            padding: 15px;
            display: none;
        }

        body.light-theme .search-results {
            background: var(--light-input);
            border: 2px solid var(--light-accent-alt);
        }

        .search-result-item {
            padding: 18px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
            margin-bottom: 10px;
        }

        body.light-theme .search-result-item {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .search-result-item:hover {
            background: rgba(78, 84, 200, 0.2);
            transform: translateX(5px);
        }

        .search-result-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--dark-accent);
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        body.light-theme .search-result-title {
            color: var(--light-accent);
        }

        .search-result-artist {
            color: #8f94fb;
            margin-bottom: 10px;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .search-result-snippet {
            color: #b0b9d8;
            font-size: 1rem;
            white-space: pre-line;
            line-height: 1.6;
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-family: 'Montserrat', sans-serif;
            border-left: 3px solid var(--dark-accent);
        }

        body.light-theme .search-result-snippet {
            color: #555;
            background: rgba(0, 0, 0, 0.05);
            border-left: 3px solid var(--light-accent);
        }

        .source-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .source-badge.cache {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            border: 1px solid #ffc107;
        }
        
        .source-badge.api {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
            border: 1px solid #2ecc71;
        }
        
        .source-badge.lrclib {
            background: rgba(86, 61, 124, 0.2);
            color: #563d7c;
            border: 1px solid #563d7c;
        }
        
        .source-badge.genius {
            background: rgba(255, 102, 0, 0.2);
            color: #ff6600;
            border: 1px solid #ff6600;
        }

        .settings-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-bottom: 25px;
        }

        .form-group {
            background: rgba(40, 40, 55, 0.8);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            border: 1px solid #555;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .form-group:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.4);
        }

        .form-group label {
            display: block;
            margin-bottom: 15px;
            font-size: 1.1rem;
            color: #b0b9d8;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-weight: 500;
        }

        body.light-theme .form-group label {
            color: #555;
        }

        .value-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 15px;
        }

        .form-group input {
            width: 100px;
            padding: 12px;
            border-radius: 12px;
            border: 2px solid var(--dark-accent-alt);
            background: #333;
            color: var(--dark-text);
            font-size: 1.6rem;
            font-weight: bold;
            text-align: center;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.5);
            font-family: 'Orbitron', sans-serif;
        }

        body.light-theme .form-group input {
            border: 2px solid var(--light-accent-alt);
            background: var(--light-input);
            color: var(--light-text);
        }

        .form-group select {
            width: 100%;
            padding: 14px;
            border-radius: 15px;
            border: 2px solid var(--dark-accent-alt);
            background: var(--dark-input);
            color: var(--dark-text);
            font-size: 1.1rem;
            font-family: 'Montserrat', sans-serif;
        }

        body.light-theme .form-group select {
            border: 2px solid var(--light-accent-alt);
            background: var(--light-input);
            color: var(--light-text);
        }

        .form-group select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.2em;
        }

        body.light-theme .form-group select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
        }

        .btn-start {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.3rem;
            font-weight: 700;
            transition: all 0.3s ease;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            box-shadow: 0 8px 25px rgba(0, 176, 155, 0.4);
            font-family: 'Montserrat', sans-serif;
        }

        .btn-start:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 176, 155, 0.6);
        }

        .btn-start:active {
            transform: translateY(0);
        }

        .teleprompter-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: #000;
            z-index: 1000;
        }

        body.light-theme .teleprompter-screen {
            background: #fff;
        }

        .lyrics-container {
            height: 100vh;
            overflow: hidden;
            position: relative;
            padding: 100px 40px 150px;
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }

        .lyrics-content {
            font-size: 3.8rem;
            line-height: 1.7;
            text-align: center;
            color: #fff;
            max-width: 95%;
            transition: transform 0.1s linear;
            will-change: transform;
            text-shadow: 0 0 15px rgba(255,255,255,0.2);
            overflow-wrap: break-word;
            word-break: break-word;
            font-weight: 600;
        }

        body.light-theme .lyrics-content {
            color: #000;
            text-shadow: 0 0 15px rgba(0,0,0,0.1);
        }

        .controls {
            position: fixed;
            bottom: 35px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 1001;
            padding: 0 20px;
            flex-wrap: wrap;
        }

        .main-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .step-controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            width: 100%;
            justify-content: center;
        }

        .control-btn {
            background: linear-gradient(135deg, var(--dark-accent-alt), #8f94fb);
            border: none;
            color: white;
            padding: 16px 28px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            font-family: 'Montserrat', sans-serif;
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(78, 84, 200, 0.5);
        }

        .scroll-indicator {
            position: fixed;
            top: 25px;
            left: 25px;
            background: rgba(0,0,0,0.7);
            padding: 15px 25px;
            border-radius: 50px;
            font-size: 1.2rem;
            color: #78ffd6;
            border: 2px solid #4e54c8;
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
            z-index: 1002;
        }

        body.light-theme .scroll-indicator {
            background: rgba(255,255,255,0.8);
            color: #0077cc;
            border: 2px solid #4e54c8;
        }

        .countdown-timer {
            position: fixed;
            top: 25px;
            right: 25px;
            background: rgba(0,0,0,0.7);
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 2.8rem;
            color: #ccff00;
            border: 2px solid #4e54c8;
            font-family: 'Orbitron', sans-serif;
            z-index: 1002;
            min-width: 250px;
            text-align: center;
            letter-spacing: 2px;
            transition: all 0.3s ease;
        }

        body.light-theme .countdown-timer {
            background: rgba(255,255,255,0.9);
            color: #003366;
            border: 2px solid #4e54c8;
        }

        .countdown-timer.blink {
            animation: blink 1s infinite;
            color: #ff0000 !important;
        }

        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }

        .examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .example-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        body.light-theme .example-card {
            background: rgba(0, 0, 0, 0.05);
        }

        .example-card:hover {
            transform: translateY(-5px);
            background: rgba(78, 84, 200, 0.1);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .example-title {
            font-size: 1.3rem;
            color: #78ffd6;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
        }

        body.light-theme .example-title {
            color: #0077cc;
        }

        .example-list {
            padding-left: 20px;
            color: #b0b9d8;
            font-size: 1rem;
        }

        body.light-theme .example-list {
            color: #555;
        }

        .example-list li {
            margin-bottom: 12px;
            line-height: 1.6;
        }

        .progress-bar {
            height: 6px;
            background: rgba(120, 255, 214, 0.3);
            border-radius: 3px;
            margin-top: 15px;
            overflow: hidden;
        }

        body.light-theme .progress-bar {
            background: rgba(0, 119, 204, 0.3);
        }

        .progress {
            height: 100%;
            background: #78ffd6;
            width: 0%;
            transition: width 0.5s ease;
        }

        body.light-theme .progress {
            background: #0077cc;
        }

        .api-info {
            margin-top: 20px;
            padding: 15px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            text-align: center;
            font-size: 1rem;
        }

        body.light-theme .api-info {
            background: rgba(0, 0, 0, 0.05);
        }

        .api-info p {
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .highlight {
            background: rgba(120, 255, 214, 0.3);
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: 600;
        }

        body.light-theme .highlight {
            background: rgba(0, 119, 204, 0.3);
        }

        .reset-timer-btn {
            background: linear-gradient(135deg, #ff9d6f, #ff6b6b);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            margin-top: 20px;
            width: 100%;
            justify-content: center;
            font-family: 'Montserrat', sans-serif;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .reset-timer-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.6);
        }

        footer {
            text-align: center;
            padding: 25px 0;
            margin-top: 30px;
            color: #b0b9d8;
            font-size: 1rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        body.light-theme footer {
            color: #555;
            border-top: 1px solid rgba(0,0,0,0.1);
        }

        @media (max-width: 1200px) {
            .step-controls {
                position: static;
                margin-top: 15px;
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .search-container {
                flex-direction: column;
            }
            
            .lyrics-content {
                font-size: 2.8rem;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .card {
                padding: 25px;
            }
            
            .settings-row {
                grid-template-columns: 1fr;
            }
            
            .countdown-timer {
                font-size: 2.2rem;
                padding: 15px 20px;
                min-width: 220px;
            }

            .controls {
                flex-direction: column;
                align-items: center;
            }

            .main-controls, .step-controls {
                width: 100%;
                justify-content: center;
            }
            
            .lyrics-container {
                padding: 90px 25px 130px;
            }
        }

        @media (max-width: 480px) {
            .lyrics-content {
                font-size: 2.2rem;
                padding: 15px;
            }
            
            .control-btn {
                padding: 14px 20px;
                font-size: 1rem;
            }
            
            h1 {
                font-size: 1.9rem;
            }
            
            .countdown-timer {
                font-size: 1.8rem;
                padding: 12px 18px;
                min-width: 190px;
            }
            
            .form-group input {
                width: 85px;
                font-size: 1.4rem;
            }
            
            .app-logo {
                width: 100px;
                height: 70px;
            }
            
            .btn-search {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body class="theme-dark">
    <div class="theme-toggle" id="themeToggle">
        <i class="fas fa-sun"></i>
    </div>

    <!-- Cronômetro fixo -->
    <div class="countdown-timer" id="countdownTimer">
        00:00:00
    </div>

    <div class="container">
        <header>
            <div class="app-logo"></div>
            <h1>Rhee TP V4.0</h1>
            <p class="subtitle">Teleprompter Musical com Genius API integrada</p>
        </header>

        <div class="card">
            <h2 class="card-title"><i class="fas fa-search"></i> Buscar Letra da Música</h2>
            
            <div class="search-container">
                <input type="text" id="songTitle" placeholder="Artista - Música (ex: Kiss - Forever)" class="search-input">
                <button type="button" id="searchBtn" class="btn-search">
                    <i class="fas fa-search"></i> Buscar
                </button>
            </div>
            
            <div class="progress-bar">
                <div class="progress" id="searchProgress"></div>
            </div>
            
            <div class="search-status" id="searchStatus">
                <i class="fas fa-info-circle"></i> Digite o nome de uma música e clique em Buscar
            </div>
            
            <div class="search-results" id="searchResults"></div>
            
            <textarea id="lyrics" class="lyrics-input" placeholder="Letras aparecerão aqui após a busca..."></textarea>
            
            <div class="examples">
                <div class="example-card">
                    <h3 class="example-title"><i class="fas fa-lightbulb"></i> Exemplos de Busca</h3>
                    <ul class="example-list">
                        <li><strong>Kiss - Forever</strong> (rock clássico)</li>
                        <li><strong>Guns N' Roses - November Rain</strong> (rock anos 90)</li>
                        <li><strong>Titãs - Polícia</strong> (rock nacional)</li>
                        <li><strong>Queen - Bohemian Rhapsody</strong> (rock progressivo)</li>
                    </ul>
                </div>
                
                <div class="example-card">
                    <h3 class="example-title"><i class="fas fa-database"></i> Armazenamento Offline</h3>
                    <ul class="example-list">
                        <li>Todas as letras buscadas são salvas automaticamente</li>
                        <li>Disponíveis mesmo sem conexão com a internet</li>
                        <li>Clique em "Limpar Cache" para remover dados salvos</li>
                    </ul>
                </div>
            </div>
            
            <div class="api-info">
                <p><i class="fas fa-info-circle"></i> Buscando em <span class="highlight">múltiplas fontes</span>: LRC Lib, Genius, Lyrist e Vagalume</p>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title"><i class="fas fa-cog"></i> Configurações do Teleprompter</h2>
            
            <div class="settings-row">
                <div class="form-group">
                    <label for="bpm"><i class="fas fa-tachometer-alt"></i> BPM (Beats por Minuto)</label>
                    <div class="value-container">
                        <input type="number" id="bpm" min="60" max="200" value="120" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="showDuration"><i class="fas fa-clock"></i> Duração do Show (minutos)</label>
                    <div class="value-container">
                        <input type="number" id="showDuration" min="1" max="300" value="30" required>
                    </div>
                </div>
            </div>
            
            <div class="settings-row">
                <div class="form-group">
                    <label for="fontSize"><i class="fas fa-text-height"></i> Tamanho da Fonte</label>
                    <select id="fontSize">
                        <option value="2.8">Pequeno</option>
                        <option value="3.8" selected>Médio</option>
                        <option value="4.8">Grande</option>
                        <option value="5.8">Muito Grande</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="textColor"><i class="fas fa-palette"></i> Cor do Texto</label>
                    <select id="textColor">
                        <option value="#ffffff" selected>Branco</option>
                        <option value="#a8ff78">Verde Fluorescente</option>
                        <option value="#78ffd6">Ciano</option>
                        <option value="#ff9d6f">Laranja</option>
                        <option value="#8f94fb">Lavanda</option>
                    </select>
                </div>
            </div>
            
            <div class="settings-row">
                <button type="button" id="startBtn" class="btn-start">
                    <i class="fas fa-play"></i> Iniciar Teleprompter
                </button>
                <button type="button" id="clearCacheBtn" class="btn-start" style="background:linear-gradient(135deg, #ff416c, #ff4b2b);">
                    <i class="fas fa-trash"></i> Limpar Cache de Letras
                </button>
            </div>
            
            <button type="button" id="resetTimerBtn" class="reset-timer-btn">
                <i class="fas fa-stopwatch"></i> Zerar Relógio
            </button>
        </div>
        
        <footer>
            Rhee TP V4.0 By Rhee Charles Design (2025) - Sistema Avançado de Teleprompter Musical
        </footer>
    </div>

    <div class="teleprompter-screen" id="teleprompterScreen">
        <div class="lyrics-container" id="lyricsContainer">
            <div class="lyrics-content" id="lyricsContent"></div>
        </div>
        
        <div class="scroll-indicator" id="scrollIndicator">
            Velocidade: 1.0x
        </div>
        
        <div class="controls">
            <div class="main-controls">
                <button class="control-btn" id="playPauseBtn"><i class="fas fa-pause"></i> Pausar</button>
                <button class="control-btn" id="speedDownBtn"><i class="fas fa-backward"></i> Mais Devagar</button>
                <button class="control-btn" id="speedUpBtn"><i class="fas fa-forward"></i> Mais Rápido</button>
                <button class="control-btn" id="resetBtn"><i class="fas fa-redo"></i> Reiniciar</button>
                <button class="control-btn" id="backBtn"><i class="fas fa-times"></i> Sair</button>
            </div>
            
            <div class="step-controls">
                <button class="control-btn" id="rewindBtn">
                    <i class="fas fa-step-backward"></i> Rewind
                </button>
                <button class="control-btn" id="fastForwardBtn">
                    <i class="fas fa-step-forward"></i> Fast Forward
                </button>
            </div>
        </div>
    </div>

    <script>
        class TeleprompterMusical {
            constructor() {
                this.lyrics = '';
                this.bpm = 120;
                this.showDuration = 30;
                this.scrollSpeed = 1.0;
                this.isPlaying = false;
                this.scrollPosition = 0;
                this.startTime = null;
                this.countdownInterval = null;
                this.animationFrame = null;
                this.baseScrollSpeed = 50;
                this.lastFrameTime = 0;
                this.maxScroll = 0;
                this.cache = {};
                this.currentLineIndex = 0;
                this.lineElements = [];
                this.remainingTime = 0;
                this.isTimerRunning = false;
                this.vagalumeApiKey = '660a4395f992ff67786584e238'; // Chave API Vagalume (exemplo)
                this.geniusAccessToken = 'd7q3fJj2pE2lLx5K4XHk6g9G1sR8aM0bV3cN7zP4tY5wQ6uI'; // Token de acesso para Genius API
                
                // Novo: Propriedades para modo sincronizado
                this.syncedLyrics = [];
                this.syncStartTime = 0;
                this.currentSyncIndex = 0;
                this.isSyncedMode = false;
                this.timeoutId = null;

                this.initializeElements();
                this.bindEvents();
                this.loadCache();
                this.setupTheme();
                this.updateCountdown();
            }

            initializeElements() {
                this.teleprompterScreen = document.getElementById('teleprompterScreen');
                this.lyricsInput = document.getElementById('lyrics');
                this.bpmInput = document.getElementById('bpm');
                this.showDurationInput = document.getElementById('showDuration');
                this.lyricsContent = document.getElementById('lyricsContent');
                this.lyricsContainer = document.getElementById('lyricsContainer');
                this.countdownTimer = document.getElementById('countdownTimer');
                this.playPauseBtn = document.getElementById('playPauseBtn');
                this.resetBtn = document.getElementById('resetBtn');
                this.backBtn = document.getElementById('backBtn');
                this.speedUpBtn = document.getElementById('speedUpBtn');
                this.speedDownBtn = document.getElementById('speedDownBtn');
                this.scrollIndicator = document.getElementById('scrollIndicator');
                this.startBtn = document.getElementById('startBtn');
                this.fontSizeSelect = document.getElementById('fontSize');
                this.textColorSelect = document.getElementById('textColor');
                this.clearCacheBtn = document.getElementById('clearCacheBtn');
                this.searchProgress = document.getElementById('searchProgress');
                this.resetTimerBtn = document.getElementById('resetTimerBtn');
                this.songTitleInput = document.getElementById('songTitle');
                this.searchBtn = document.getElementById('searchBtn');
                this.searchStatus = document.getElementById('searchStatus');
                this.searchResults = document.getElementById('searchResults');
                this.rewindBtn = document.getElementById('rewindBtn');
                this.fastForwardBtn = document.getElementById('fastForwardBtn');
                this.themeToggle = document.getElementById('themeToggle');
            }

            bindEvents() {
                this.startBtn.addEventListener('click', () => this.startTeleprompter());
                this.playPauseBtn.addEventListener('click', () => this.togglePlayPause());
                this.resetBtn.addEventListener('click', () => this.resetTeleprompter());
                this.backBtn.addEventListener('click', () => this.goBack());
                this.speedUpBtn.addEventListener('click', () => this.adjustSpeed(0.1));
                this.speedDownBtn.addEventListener('click', () => this.adjustSpeed(-0.1));
                this.clearCacheBtn.addEventListener('click', () => this.clearCache());
                this.resetTimerBtn.addEventListener('click', () => this.resetTimer());
                this.searchBtn.addEventListener('click', () => this.searchLyrics());
                this.themeToggle.addEventListener('click', () => this.toggleTheme());
                this.rewindBtn.addEventListener('click', () => this.stepBackward());
                this.fastForwardBtn.addEventListener('click', () => this.stepForward());

                this.songTitleInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.searchLyrics();
                });

                document.addEventListener('keydown', (e) => {
                    if (this.teleprompterScreen.style.display === 'block') {
                        switch(e.key) {
                            case ' ': this.togglePlayPause(); break;
                            case 'r': this.resetTeleprompter(); break;
                            case 'Escape': this.goBack(); break;
                            case 'ArrowUp': this.adjustSpeed(0.1); break;
                            case 'ArrowDown': this.adjustSpeed(-0.1); break;
                            case 'ArrowLeft': this.stepBackward(); break;
                            case 'ArrowRight': this.stepForward(); break;
                        }
                    }
                });
            }

            setupTheme() {
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'light') {
                    document.body.classList.add('light-theme');
                    this.themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                } else {
                    document.body.classList.remove('light-theme');
                    this.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                    localStorage.setItem('theme', 'dark');
                }
            }

            toggleTheme() {
                if (document.body.classList.contains('light-theme')) {
                    document.body.classList.remove('light-theme');
                    this.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.body.classList.add('light-theme');
                    this.themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                    localStorage.setItem('theme', 'light');
                }
            }

            startTeleprompter() {
                this.lyrics = this.lyricsInput.value.trim();
                
                if (!this.lyrics) {
                    this.showSearchStatus('Por favor, busque e carregue uma letra primeiro', 'error');
                    return;
                }

                // Verificar se é letra sincronizada
                this.isSyncedMode = this.detectSyncedLyrics(this.lyrics);
                
                this.bpm = parseInt(this.bpmInput.value);
                this.showDuration = parseInt(this.showDurationInput.value);
                const fontSize = this.fontSizeSelect.value + 'rem';
                const textColor = this.textColorSelect.value;

                // Preparar letras
                this.lyricsContent.innerHTML = '';
                const formattedLyrics = this.formatLyrics(this.lyrics, this.isSyncedMode);
                this.lyricsContent.appendChild(formattedLyrics);
                this.lyricsContent.style.fontSize = fontSize;
                this.lyricsContent.style.color = textColor;
                
                // Resetar estado
                this.scrollPosition = 0;
                this.currentLineIndex = 0;
                this.isPlaying = true;
                
                setTimeout(() => {
                    // Obter elementos de linha
                    this.lineElements = Array.from(this.lyricsContent.querySelectorAll('div'));
                    
                    // Para letras sincronizadas: processar timestamps
                    if (this.isSyncedMode) {
                        this.processSyncedLyrics(this.lyrics);
                        this.maxScroll = this.lineElements.reduce(
                            (total, el) => total + el.offsetHeight, 
                            0
                        ) - this.lyricsContainer.offsetHeight;
                        this.scrollPosition = 0;
                        this.updateScrollPosition();
                        
                        // Iniciar contagem regressiva mas não rolagem ainda
                        this.startCountdown();
                        this.syncStartTime = Date.now();
                        this.currentSyncIndex = 0;
                        this.playSyncedLyrics();
                    } 
                    // Para letras não sincronizadas: comportamento padrão
                    else {
                        this.maxScroll = this.lineElements.reduce(
                            (total, el) => total + el.offsetHeight, 
                            0
                        ) - this.lyricsContainer.offsetHeight;
                        this.baseScrollSpeed = this.bpm * 0.8;
                        this.scrollPosition = 0;
                        this.updateScrollPosition();
                        this.startScrolling();
                        this.startCountdown();
                    }
                }, 100);

                // Mostrar tela do teleprompter
                this.teleprompterScreen.style.display = 'block';
            }

            // Detectar se a letra possui timestamps
            detectSyncedLyrics(lyrics) {
                const lines = lyrics.split('\n');
                const syncPattern = /^\[\d{1,2}:\d{2}(\.\d{1,3})?\]/;
                return lines.some(line => syncPattern.test(line.trim()));
            }

            // Processar letras sincronizadas
            processSyncedLyrics(lyrics) {
                this.syncedLyrics = [];
                const lines = lyrics.split('\n');
                const syncPattern = /^\[(\d{1,2}):(\d{2})(?:\.(\d{1,3}))?\]\s*(.*)$/;
                
                lines.forEach(line => {
                    const match = line.match(syncPattern);
                    if (match) {
                        const minutes = parseInt(match[1]);
                        const seconds = parseInt(match[2]);
                        const milliseconds = match[3] ? parseInt(match[3].padEnd(3, '0')) : 0;
                        
                        const totalMs = (minutes * 60 + seconds) * 1000 + milliseconds;
                        const text = match[4] || '';
                        
                        this.syncedLyrics.push({
                            time: totalMs,
                            text: text
                        });
                    }
                });
                
                // Ordenar por tempo
                this.syncedLyrics.sort((a, b) => a.time - b.time);
            }

            // Controlador para letras sincronizadas
            playSyncedLyrics() {
                if (!this.isPlaying) return;
                
                const now = Date.now() - this.syncStartTime;
                
                // Avançar para a próxima linha sincronizada
                while (this.currentSyncIndex < this.syncedLyrics.length && 
                       now >= this.syncedLyrics[this.currentSyncIndex].time) {
                    
                    // Encontrar a posição da linha correspondente
                    const lineIndex = this.lineElements.findIndex(el => 
                        el.textContent.includes(this.syncedLyrics[this.currentSyncIndex].text)
                    );
                    
                    if (lineIndex !== -1) {
                        this.currentLineIndex = lineIndex;
                        this.scrollPosition = this.calculateLinePosition(lineIndex);
                        this.updateScrollPosition();
                    }
                    
                    this.currentSyncIndex++;
                }
                
                // Continuar verificando
                if (this.currentSyncIndex < this.syncedLyrics.length) {
                    const nextLyric = this.syncedLyrics[this.currentSyncIndex];
                    const delay = Math.max(0, nextLyric.time - now);
                    
                    // Agendar próxima verificação
                    clearTimeout(this.timeoutId);
                    this.timeoutId = setTimeout(() => {
                        requestAnimationFrame(() => this.playSyncedLyrics());
                    }, delay);
                } else {
                    // Fim da letra sincronizada
                    this.pauseScrolling();
                }
            }

            // Formatador atualizado para remover timestamps
            formatLyrics(lyrics, isSynced = false) {
                const fragment = document.createDocumentFragment();
                const lines = lyrics.split('\n');
                const syncPattern = /^\[\d{1,2}:\d{2}(\.\d{1,3})?\]\s*/;
                
                lines.forEach(line => {
                    const div = document.createElement('div');
                    
                    // Remover timestamp se for modo sincronizado
                    const displayText = isSynced ? 
                        line.replace(syncPattern, '') : 
                        line;
                        
                    div.textContent = displayText.trim() === '' ? '\u00A0' : displayText;
                    if (displayText.trim() === '') div.classList.add('empty-line');
                    fragment.appendChild(div);
                });
                
                return fragment;
            }

            // Calcular posição de uma linha específica
            calculateLinePosition(lineIndex) {
                if (lineIndex === 0) return 0;
                
                let position = 0;
                for (let i = 0; i < lineIndex; i++) {
                    position += this.lineElements[i].offsetHeight;
                }
                
                return position;
            }

            updateScrollPosition() {
                this.lyricsContent.style.transform = `translateY(-${this.scrollPosition}px)`;
            }

            startCountdown() {
                if (this.countdownInterval) clearInterval(this.countdownInterval);
                
                // Remover estado de piscar (se houver)
                this.countdownTimer.classList.remove('blink');
                this.countdownTimer.style.color = '#ccff00'; // Cor original
                
                this.startTime = Date.now();
                const totalMs = this.showDuration * 60 * 1000;
                this.remainingTime = totalMs;
                this.isTimerRunning = true;

                this.countdownInterval = setInterval(() => {
                    this.updateCountdown();
                }, 100);
            }

            updateCountdown() {
                // Se o tempo acabou e já está no estado final, não faz nada
                if (this.remainingTime <= 0 && this.isTimerRunning) {
                    this.countdownTimer.textContent = "TEMPO ESGOTADO!";
                    this.countdownTimer.classList.add('blink');
                    this.isTimerRunning = false;
                    this.pauseScrolling();
                    return;
                }

                // Atualiza o tempo restante
                this.remainingTime -= 100;

                const hours = Math.floor(this.remainingTime / 3600000);
                const minutes = Math.floor((this.remainingTime % 3600000) / 60000);
                const seconds = Math.floor((this.remainingTime % 60000) / 1000);

                this.countdownTimer.textContent =
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                // Se o tempo acabou após esta atualização
                if (this.remainingTime <= 0 && this.isTimerRunning) {
                    this.countdownTimer.textContent = "TEMPO ESGOTADO!";
                    this.countdownTimer.classList.add('blink');
                    this.isTimerRunning = false;
                    this.pauseScrolling();
                }
            }

            startScrolling() {
                this.isPlaying = true;
                this.playPauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pausar';
                this.lastFrameTime = performance.now();
                this.animate();
            }

            animate() {
                if (!this.isPlaying) return;
                
                const now = performance.now();
                const delta = (now - this.lastFrameTime) / 1000;
                this.lastFrameTime = now;
                
                this.scrollPosition += this.baseScrollSpeed * this.scrollSpeed * delta;
                
                if (this.scrollPosition >= this.maxScroll) {
                    this.scrollPosition = this.maxScroll;
                    this.pauseScrolling();
                }
                
                this.updateScrollPosition();
                this.updateCurrentLineIndex();
                
                this.animationFrame = requestAnimationFrame(() => this.animate());
            }

            updateCurrentLineIndex() {
                if (this.lineElements.length === 0) return;
                
                let cumulativeHeight = 0;
                for (let i = 0; i < this.lineElements.length; i++) {
                    cumulativeHeight += this.lineElements[i].offsetHeight;
                    if (cumulativeHeight > this.scrollPosition) {
                        this.currentLineIndex = i;
                        break;
                    }
                }
            }

            togglePlayPause() {
                this.isPlaying = !this.isPlaying;
                this.playPauseBtn.innerHTML = this.isPlaying ? 
                    '<i class="fas fa-pause"></i> Pausar' : 
                    '<i class="fas fa-play"></i> Continuar';
                
                if (this.isPlaying) {
                    if (this.isSyncedMode) {
                        this.syncStartTime += Date.now() - this.pauseTime;
                        this.playSyncedLyrics();
                    } else {
                        this.lastFrameTime = performance.now();
                        this.animate();
                    }
                } else {
                    this.pauseTime = Date.now();
                }
            }

            pauseScrolling() {
                this.isPlaying = false;
                this.playPauseBtn.innerHTML = '<i class="fas fa-play"></i> Continuar';
                if (this.animationFrame) {
                    cancelAnimationFrame(this.animationFrame);
                    this.animationFrame = null;
                }
                clearTimeout(this.timeoutId);
            }

            resetTeleprompter() {
                this.scrollPosition = 0;
                this.currentLineIndex = 0;
                
                if (this.isSyncedMode) {
                    this.currentSyncIndex = 0;
                    this.syncStartTime = Date.now();
                }
                
                this.updateScrollPosition();
                this.isPlaying = true;
                this.playPauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pausar';
                
                if (this.isSyncedMode) {
                    this.playSyncedLyrics();
                } else {
                    this.startScrolling();
                }
            }

            resetTimer() {
                // Parar a contagem regressiva atual
                if (this.countdownInterval) {
                    clearInterval(this.countdownInterval);
                    this.countdownInterval = null;
                }

                // Remover o estado de tempo esgotado
                this.countdownTimer.classList.remove('blink');
                this.countdownTimer.style.color = '#ccff00'; // Cor original

                // Reiniciar o tempo restante
                this.remainingTime = this.showDuration * 60 * 1000;
                
                // Atualizar o display para o tempo completo
                const hours = Math.floor(this.remainingTime / 3600000);
                const minutes = Math.floor((this.remainingTime % 3600000) / 60000);
                const seconds = Math.floor((this.remainingTime % 60000) / 1000);
                this.countdownTimer.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                // Se o teleprompter estiver ativo, reiniciar a contagem regressiva
                if (this.teleprompterScreen.style.display === 'block') {
                    this.startCountdown();
                }
            }

            adjustSpeed(delta) {
                this.scrollSpeed = Math.max(0.1, Math.min(3.0, this.scrollSpeed + delta));
                this.scrollIndicator.textContent = `Velocidade: ${this.scrollSpeed.toFixed(1)}x`;
            }

            goBack() {
                this.pauseScrolling();
                this.teleprompterScreen.style.display = 'none';
                this.scrollPosition = 0;
                this.scrollSpeed = 1.0;
                this.isPlaying = false;
            }

            loadCache() {
                const cacheData = localStorage.getItem('lyricsCache');
                if (cacheData) {
                    try {
                        this.cache = JSON.parse(cacheData);
                        this.showSearchStatus(`Cache carregado: ${Object.keys(this.cache).length} letras disponíveis offline`, 'success');
                    } catch (e) {
                        this.cache = {};
                    }
                }
            }

            saveToCache(song, artist, lyrics) {
                const cacheKey = `${song.toLowerCase()}-${artist.toLowerCase()}`;
                this.cache[cacheKey] = {
                    title: song,
                    artist: artist,
                    lyrics: lyrics,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('lyricsCache', JSON.stringify(this.cache));
            }

            getFromCache(song, artist) {
                const cacheKey = `${song.toLowerCase()}-${artist.toLowerCase()}`;
                return this.cache[cacheKey];
            }

            clearCache() {
                this.cache = {};
                localStorage.removeItem('lyricsCache');
                this.showSearchStatus('Cache de letras limpo com sucesso!', 'success');
            }

            async searchLyrics() {
                const query = this.songTitleInput.value.trim();
                
                if (!query) {
                    this.showSearchStatus('Por favor, digite o nome da música', 'error');
                    return;
                }

                let artist = '';
                let song = query;
                
                if (query.includes('-')) {
                    const parts = query.split('-').map(p => p.trim());
                    if (parts.length >= 2) {
                        artist = parts[0];
                        song = parts.slice(1).join('-').trim();
                    }
                }

                this.showSearchStatus(`Buscando "${song}"...`, 'loading');
                this.searchProgress.style.width = '20%';
                this.searchResults.innerHTML = '';
                this.searchResults.style.display = 'none';

                try {
                    const cachedResult = this.getFromCache(song, artist);
                    
                    if (cachedResult) {
                        this.displaySearchResults([cachedResult], song, 'cache');
                        this.showSearchStatus('Letra encontrada no cache offline!', 'success');
                        this.searchProgress.style.width = '100%';
                        return;
                    }

                    if (!navigator.onLine) {
                        this.showSearchStatus('Sem conexão com a internet - usando apenas cache offline', 'error');
                        this.searchProgress.style.width = '0%';
                        return;
                    }

                    // Tentar primeira API (LRC Lib)
                    this.searchProgress.style.width = '25%';
                    let result = await this.fetchLrcLibLyrics(song, artist);
                    
                    if (!result) {
                        // Se falhar, tentar API do Genius
                        this.searchProgress.style.width = '40%';
                        this.showSearchStatus('Tentando Genius API...', 'warning');
                        result = await this.fetchGeniusLyrics(song, artist);
                    }

                    if (!result) {
                        // Se falhar, tentar API do Lyrist
                        this.searchProgress.style.width = '55%';
                        this.showSearchStatus('Tentando Lyrist API...', 'warning');
                        result = await this.fetchLyristLyrics(song, artist);
                    }

                    if (!result) {
                        // Se falhar, tentar API do Vagalume
                        this.searchProgress.style.width = '70%';
                        this.showSearchStatus('Tentando Vagalume API...', 'warning');
                        result = await this.fetchVagalumeLyrics(song, artist);
                    }

                    if (result) {
                        this.displaySearchResults([result], song, 'api');
                        this.showSearchStatus('Letra encontrada!', 'success');
                        this.searchProgress.style.width = '100%';
                    } else {
                        this.showSearchStatus('Não foi possível encontrar a letra desta música', 'error');
                        this.searchProgress.style.width = '0%';
                    }
                } catch (error) {
                    this.showSearchStatus('Erro ao buscar letra: ' + error.message, 'error');
                    this.searchProgress.style.width = '0%';
                }
            }

            async fetchLrcLibLyrics(song, artist) {
                try {
                    const query = artist ? `${artist} ${song}` : song;
                    const apiUrl = `https://lrclib.net/api/search?q=${encodeURIComponent(query)}`;
                    
                    const response = await fetch(apiUrl, {
                        signal: AbortSignal.timeout(5000) // Timeout de 5 segundos
                    });
                    
                    if (!response.ok) {
                        throw new Error('API indisponível');
                    }
                    
                    const data = await response.json();
                    
                    if (data && data.length > 0) {
                        // Priorizar letras sincronizadas quando disponíveis
                        const result = data.find(item => item.syncedLyrics) || data[0];
                        
                        const lyrics = result.syncedLyrics || result.plainLyrics;
                        const artistName = result.artistName || artist || 'Artista desconhecido';
                        const songTitle = result.trackName || song;
                        
                        this.saveToCache(songTitle, artistName, lyrics);
                        return {
                            title: songTitle,
                            artist: artistName,
                            lyrics: lyrics,
                            source: 'LRC Lib'
                        };
                    }
                } catch (error) {
                    console.warn('Erro na LRC Lib API:', error.message);
                    return null;
                }
            }

            async fetchGeniusLyrics(song, artist) {
                try {
                    // Primeiro: Buscar a música na API do Genius
                    const searchQuery = artist ? `${artist} ${song}` : song;
                    const searchUrl = `https://api.genius.com/search?q=${encodeURIComponent(searchQuery)}`;
                    
                    const searchResponse = await fetch(searchUrl, {
                        headers: {
                            'Authorization': `Bearer ${this.geniusAccessToken}`
                        },
                        signal: AbortSignal.timeout(6000)
                    });
                    
                    if (!searchResponse.ok) {
                        throw new Error('Falha na busca do Genius');
                    }
                    
                    const searchData = await searchResponse.json();
                    
                    // Verificar se há resultados
                    if (searchData.response && searchData.response.hits && searchData.response.hits.length > 0) {
                        // Pegar o primeiro resultado
                        const songResult = searchData.response.hits[0].result;
                        const songId = songResult.id;
                        
                        // Segundo: Buscar os detalhes da música (incluindo URL da letra)
                        const songUrl = `https://api.genius.com/songs/${songId}?text_format=plain`;
                        
                        const songResponse = await fetch(songUrl, {
                            headers: {
                                'Authorization': `Bearer ${this.geniusAccessToken}`
                            },
                            signal: AbortSignal.timeout(6000)
                        });
                        
                        if (!songResponse.ok) {
                            throw new Error('Falha ao obter detalhes da música');
                        }
                        
                        const songData = await songResponse.json();
                        
                        // Terceiro: Obter a letra da música
                        const lyricsUrl = songData.response.song.url;
                        const lyrics = await this.fetchGeniusLyricsFromUrl(lyricsUrl);
                        
                        if (lyrics) {
                            this.saveToCache(song, artist, lyrics);
                            return {
                                title: song,
                                artist: artist || songData.response.song.primary_artist.name || 'Artista desconhecido',
                                lyrics: lyrics,
                                source: 'Genius API'
                            };
                        }
                    }
                } catch (error) {
                    console.warn('Erro na Genius API:', error.message);
                }
                return null;
            }

            async fetchGeniusLyricsFromUrl(url) {
                try {
                    // Usar um proxy para contornar restrições CORS
                    const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                    const response = await fetch(proxyUrl + url, {
                        signal: AbortSignal.timeout(8000)
                    });
                    
                    if (!response.ok) {
                        throw new Error('Falha ao obter letra');
                    }
                    
                    const html = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    // Extrair letra da estrutura do Genius
                    const lyricsContainer = doc.querySelector('div[data-lyrics-container="true"]');
                    if (lyricsContainer) {
                        // Processar e limpar a letra
                        let lyrics = lyricsContainer.innerHTML;
                        lyrics = lyrics.replace(/<br>/g, '\n');
                        lyrics = lyrics.replace(/<[^>]*>/g, '');
                        lyrics = lyrics.replace(/\[.*?\]/g, '');
                        return lyrics;
                    }
                } catch (error) {
                    console.warn('Erro ao extrair letra do Genius:', error);
                }
                return null;
            }

            async fetchLyristLyrics(song, artist) {
                try {
                    let apiUrl;
                    
                    if (artist) {
                        apiUrl = `https://lyrist.vercel.app/api/${encodeURIComponent(artist)}/${encodeURIComponent(song)}`;
                    } else {
                        apiUrl = `https://lyrist.vercel.app/api/${encodeURIComponent(song)}`;
                    }
                    
                    const response = await fetch(apiUrl, {
                        signal: AbortSignal.timeout(5000)
                    });
                    
                    if (!response.ok) {
                        throw new Error('API indisponível');
                    }
                    
                    const data = await response.json();
                    
                    if (data && data.lyrics) {
                        const lyrics = data.lyrics.replace(/\n/g, '\n');
                        this.saveToCache(song, artist, lyrics);
                        return {
                            title: song,
                            artist: artist || data.artist || 'Artista desconhecido',
                            lyrics: lyrics,
                            source: 'Lyrist API'
                        };
                    }
                } catch (error) {
                    console.warn('Erro na Lyrist API:', error.message);
                    return null;
                }
            }

            async fetchVagalumeLyrics(song, artist) {
                try {
                    if (!artist) {
                        console.warn('API Vagalume requer artista e música');
                        return null;
                    }
                    
                    const apiUrl = `https://api.vagalume.com.br/search.php?art=${encodeURIComponent(artist)}&mus=${encodeURIComponent(song)}&apikey=${this.vagalumeApiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        signal: AbortSignal.timeout(7000)
                    });
                    
                    if (!response.ok) {
                        throw new Error('API Vagalume indisponível');
                    }
                    
                    const data = await response.json();
                    
                    if (data.type === 'exact' && data.mus && data.mus.length > 0 && data.mus[0].text) {
                        const lyrics = data.mus[0].text.replace(/<br>/g, '\n');
                        this.saveToCache(song, artist, lyrics);
                        return {
                            title: song,
                            artist: artist,
                            lyrics: lyrics,
                            source: 'Vagalume API'
                        };
                    }
                } catch (error) {
                    console.warn('Erro na Vagalume API:', error.message);
                    return null;
                }
            }

            displaySearchResults(results, requestedSong, sourceType) {
                this.searchResults.innerHTML = '';
                
                if (results.length === 0) {
                    const noResults = document.createElement('div');
                    noResults.className = 'search-result-item';
                    noResults.textContent = `Nenhum resultado encontrado para "${requestedSong}"`;
                    this.searchResults.appendChild(noResults);
                } else {
                    results.forEach(result => {
                        const item = document.createElement('div');
                        item.className = 'search-result-item';
                        
                        const title = document.createElement('div');
                        title.className = 'search-result-title';
                        title.textContent = result.title;
                        
                        // Mostrar a fonte da letra
                        let sourceBadge = '';
                        switch(sourceType) {
                            case 'cache':
                                sourceBadge = `<span class="source-badge cache">Offline</span>`;
                                break;
                            case 'api':
                                if (result.source === 'LRC Lib') {
                                    sourceBadge = `<span class="source-badge lrclib">${result.source}</span>`;
                                } else if (result.source === 'Genius API') {
                                    sourceBadge = `<span class="source-badge genius">${result.source}</span>`;
                                } else {
                                    sourceBadge = `<span class="source-badge api">${result.source}</span>`;
                                }
                                break;
                        }
                        
                        title.innerHTML += sourceBadge;
                        
                        const artist = document.createElement('div');
                        artist.className = 'search-result-artist';
                        artist.textContent = result.artist || 'Artista desconhecido';
                        
                        const snippet = document.createElement('div');
                        snippet.className = 'search-result-snippet';
                        snippet.textContent = result.lyrics.split('\n').slice(0, 6).join('\n') + '\n...';
                        
                        item.appendChild(title);
                        item.appendChild(artist);
                        item.appendChild(snippet);
                        
                        item.addEventListener('click', () => {
                            this.lyricsInput.value = result.lyrics;
                            this.searchResults.style.display = 'none';
                            this.showSearchStatus(`Letra de "${result.title}" carregada!`, 'success');
                        });
                        
                        this.searchResults.appendChild(item);
                    });
                }
                
                this.searchResults.style.display = 'block';
            }

            showSearchStatus(message, type) {
                this.searchStatus.textContent = message;
                this.searchStatus.className = `search-status ${type}`;
                this.searchStatus.innerHTML = `<i class="fas fa-${this.getStatusIcon(type)}"></i> ${message}`;
            }

            getStatusIcon(type) {
                switch(type) {
                    case 'loading': return 'spinner fa-pulse';
                    case 'success': return 'check-circle';
                    case 'error': return 'exclamation-circle';
                    case 'warning': return 'exclamation-triangle';
                    default: return 'info-circle';
                }
            }
            
            stepForward() {
                if (this.lineElements.length === 0) return;
                
                this.pauseScrolling();
                this.currentLineIndex = Math.min(this.lineElements.length - 1, this.currentLineIndex + 1);
                this.scrollPosition = this.calculateLinePosition(this.currentLineIndex);
                this.updateScrollPosition();
            }

            stepBackward() {
                if (this.lineElements.length === 0) return;
                
                this.pauseScrolling();
                this.currentLineIndex = Math.max(0, this.currentLineIndex - 1);
                this.scrollPosition = this.calculateLinePosition(this.currentLineIndex);
                this.updateScrollPosition();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const app = new TeleprompterMusical();
            document.getElementById('songTitle').focus();
            
            // Teste com letra sincronizada
            setTimeout(() => {
                const syncedLyrics = [
                    "[00:00.50] Começo da música",
                    "[00:15.20] Primeiro verso",
                    "[00:30.75] Segunda linha",
                    "[00:45.30] Refrão",
                    "[01:15.00] Solo de guitarra"
                ].join('\n');
                
                document.getElementById('lyrics').value = syncedLyrics;
            }, 1000);
        });
    </script>
</body>
</html>